$domain = ([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).Name
$searcher = New-Object DirectoryServices.DirectorySearcher
$searcher.Filter = "(objectCategory=person)"
$searcher.PageSize = 1000
$searcher.PropertiesToLoad.Add("sAMAccountName") > $null

$results = $searcher.FindAll()
$users = @()

foreach ($result in $results) {
    if ($result.Properties["samaccountname"]) {
        $users += $result.Properties["samaccountname"]
    }
}

$users | Out-File -Encoding ASCII -FilePath "domain_users.txt"
Write-Host "Saved to domain_users.txt"
